<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>WISMAS:  Fichier source de qextserialport_p.h</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />

<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  <td id="projectlogo"><img alt="Logo" src="icone-wismas.png"/></td>
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">WISMAS
   &#160;<span id="projectnumber">0.8</span>
   </div>
   <div id="projectbrief">BTS SN-IR La Salle Avignon 2018</div>
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Généré par Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Recherche');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Page&#160;principale</span></a></li>
      <li><a href="pages.html"><span>Pages&#160;associées</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Fichiers</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Recherche" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>Liste&#160;des&#160;fichiers</span></a></li>
      <li><a href="globals.html"><span>Membres&#160;de&#160;fichier</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">qextserialport_p.h</div>  </div>
</div><!--header-->
<div class="contents">
<a href="qextserialport__p_8h.html">Aller à la documentation de ce fichier.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/****************************************************************************</span>
<a name="l00002"></a>00002 <span class="comment">** Copyright (c) 2000-2003 Wayne Roth</span>
<a name="l00003"></a>00003 <span class="comment">** Copyright (c) 2004-2007 Stefan Sander</span>
<a name="l00004"></a>00004 <span class="comment">** Copyright (c) 2007 Michal Policht</span>
<a name="l00005"></a>00005 <span class="comment">** Copyright (c) 2008 Brandon Fosdick</span>
<a name="l00006"></a>00006 <span class="comment">** Copyright (c) 2009-2010 Liam Staskawicz</span>
<a name="l00007"></a>00007 <span class="comment">** Copyright (c) 2011 Debao Zhang</span>
<a name="l00008"></a>00008 <span class="comment">** All right reserved.</span>
<a name="l00009"></a>00009 <span class="comment">** Web: http://code.google.com/p/qextserialport/</span>
<a name="l00010"></a>00010 <span class="comment">**</span>
<a name="l00011"></a>00011 <span class="comment">** Permission is hereby granted, free of charge, to any person obtaining</span>
<a name="l00012"></a>00012 <span class="comment">** a copy of this software and associated documentation files (the</span>
<a name="l00013"></a>00013 <span class="comment">** &quot;Software&quot;), to deal in the Software without restriction, including</span>
<a name="l00014"></a>00014 <span class="comment">** without limitation the rights to use, copy, modify, merge, publish,</span>
<a name="l00015"></a>00015 <span class="comment">** distribute, sublicense, and/or sell copies of the Software, and to</span>
<a name="l00016"></a>00016 <span class="comment">** permit persons to whom the Software is furnished to do so, subject to</span>
<a name="l00017"></a>00017 <span class="comment">** the following conditions:</span>
<a name="l00018"></a>00018 <span class="comment">**</span>
<a name="l00019"></a>00019 <span class="comment">** The above copyright notice and this permission notice shall be</span>
<a name="l00020"></a>00020 <span class="comment">** included in all copies or substantial portions of the Software.</span>
<a name="l00021"></a>00021 <span class="comment">**</span>
<a name="l00022"></a>00022 <span class="comment">** THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND,</span>
<a name="l00023"></a>00023 <span class="comment">** EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF</span>
<a name="l00024"></a>00024 <span class="comment">** MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND</span>
<a name="l00025"></a>00025 <span class="comment">** NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE</span>
<a name="l00026"></a>00026 <span class="comment">** LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION</span>
<a name="l00027"></a>00027 <span class="comment">** OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION</span>
<a name="l00028"></a>00028 <span class="comment">** WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.</span>
<a name="l00029"></a>00029 <span class="comment">**</span>
<a name="l00030"></a>00030 <span class="comment">****************************************************************************/</span>
<a name="l00031"></a>00031 
<a name="l00032"></a>00032 <span class="preprocessor">#ifndef _QEXTSERIALPORT_P_H_</span>
<a name="l00033"></a>00033 <span class="preprocessor"></span><span class="preprocessor">#define _QEXTSERIALPORT_P_H_</span>
<a name="l00034"></a>00034 <span class="preprocessor"></span>
<a name="l00035"></a>00035 <span class="comment">//</span>
<a name="l00036"></a>00036 <span class="comment">//  W A R N I N G</span>
<a name="l00037"></a>00037 <span class="comment">//  -------------</span>
<a name="l00038"></a>00038 <span class="comment">//</span>
<a name="l00039"></a>00039 <span class="comment">// This file is not part of the QESP API.  It exists for the convenience</span>
<a name="l00040"></a>00040 <span class="comment">// of other QESP classes.  This header file may change from version to</span>
<a name="l00041"></a>00041 <span class="comment">// version without notice, or even be removed.</span>
<a name="l00042"></a>00042 <span class="comment">//</span>
<a name="l00043"></a>00043 <span class="comment">// We mean it.</span>
<a name="l00044"></a>00044 <span class="comment">//</span>
<a name="l00045"></a>00045 
<a name="l00046"></a>00046 <span class="preprocessor">#include &quot;<a class="code" href="qextserialport_8h.html">qextserialport.h</a>&quot;</span>
<a name="l00047"></a>00047 <span class="preprocessor">#include &lt;QtCore/QReadWriteLock&gt;</span>
<a name="l00048"></a>00048 <span class="preprocessor">#ifdef Q_OS_UNIX</span>
<a name="l00049"></a>00049 <span class="preprocessor"></span><span class="preprocessor">#  include &lt;termios.h&gt;</span>
<a name="l00050"></a>00050 <span class="preprocessor">#elif (defined Q_OS_WIN)</span>
<a name="l00051"></a>00051 <span class="preprocessor"></span><span class="preprocessor">#  include &lt;QtCore/qt_windows.h&gt;</span>
<a name="l00052"></a>00052 <span class="preprocessor">#endif</span>
<a name="l00053"></a>00053 <span class="preprocessor"></span><span class="preprocessor">#include &lt;stdlib.h&gt;</span>
<a name="l00054"></a>00054 
<a name="l00055"></a>00055 <span class="comment">// This is QextSerialPort&#39;s read buffer, needed by posix system.</span>
<a name="l00056"></a>00056 <span class="comment">// ref: QRingBuffer &amp; QIODevicePrivateLinearBuffer</span>
<a name="l00062"></a><a class="code" href="class_qext_read_buffer.html">00062</a> <span class="comment"></span><span class="keyword">class </span><a class="code" href="class_qext_read_buffer.html">QextReadBuffer</a>
<a name="l00063"></a>00063 {
<a name="l00064"></a>00064 <span class="keyword">public</span>:
<a name="l00071"></a><a class="code" href="class_qext_read_buffer.html#a7ae54f95b884a2ac522c7f27a9e1eb5d">00071</a>     <span class="keyword">inline</span> <a class="code" href="class_qext_read_buffer.html#a7ae54f95b884a2ac522c7f27a9e1eb5d">QextReadBuffer</a>(<span class="keywordtype">size_t</span> growth=4096)
<a name="l00072"></a>00072         : <a class="code" href="class_qext_read_buffer.html#aa30b3290fc4d7c660140ce8235bd118e">len</a>(0), <a class="code" href="class_qext_read_buffer.html#a74b0541d6654ec67f622e9b4d2af4fed">first</a>(0), <a class="code" href="class_qext_read_buffer.html#ae7e22b951d9a0c2701e801040d282709">buf</a>(0), <a class="code" href="class_qext_read_buffer.html#aad8b22b5bacd39e99318937bc2997b8e">capacity</a>(0), <a class="code" href="class_qext_read_buffer.html#a1a1622e991fd932f499d615a214956ef">basicBlockSize</a>(growth) {
<a name="l00073"></a>00073     }
<a name="l00074"></a>00074 
<a name="l00080"></a><a class="code" href="class_qext_read_buffer.html#a1bfa8c72d9ab2ec23ee45bc5ad77747a">00080</a>     <a class="code" href="class_qext_read_buffer.html#a1bfa8c72d9ab2ec23ee45bc5ad77747a">~QextReadBuffer</a>() {
<a name="l00081"></a>00081         <span class="keyword">delete</span> [] <a class="code" href="class_qext_read_buffer.html#ae7e22b951d9a0c2701e801040d282709">buf</a>;
<a name="l00082"></a>00082     }
<a name="l00083"></a>00083 
<a name="l00089"></a><a class="code" href="class_qext_read_buffer.html#a2391683c7c1b5b62d771dda087b868e2">00089</a>     <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="class_qext_read_buffer.html#a2391683c7c1b5b62d771dda087b868e2">clear</a>() {
<a name="l00090"></a>00090         <a class="code" href="class_qext_read_buffer.html#a74b0541d6654ec67f622e9b4d2af4fed">first</a> = <a class="code" href="class_qext_read_buffer.html#ae7e22b951d9a0c2701e801040d282709">buf</a>;
<a name="l00091"></a>00091         <a class="code" href="class_qext_read_buffer.html#aa30b3290fc4d7c660140ce8235bd118e">len</a> = 0;
<a name="l00092"></a>00092     }
<a name="l00093"></a>00093 
<a name="l00100"></a><a class="code" href="class_qext_read_buffer.html#a6a2dcf1b616a57f6f6355db72e7e8052">00100</a>     <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="class_qext_read_buffer.html#a6a2dcf1b616a57f6f6355db72e7e8052">size</a>()<span class="keyword"> const </span>{
<a name="l00101"></a>00101         <span class="keywordflow">return</span> <a class="code" href="class_qext_read_buffer.html#aa30b3290fc4d7c660140ce8235bd118e">len</a>;
<a name="l00102"></a>00102     }
<a name="l00103"></a>00103 
<a name="l00110"></a><a class="code" href="class_qext_read_buffer.html#aede88712a12203957327592ac86550f4">00110</a>     <span class="keyword">inline</span> <span class="keywordtype">bool</span> <a class="code" href="class_qext_read_buffer.html#aede88712a12203957327592ac86550f4">isEmpty</a>()<span class="keyword"> const </span>{
<a name="l00111"></a>00111         <span class="keywordflow">return</span> <a class="code" href="class_qext_read_buffer.html#aa30b3290fc4d7c660140ce8235bd118e">len</a> == 0;
<a name="l00112"></a>00112     }
<a name="l00113"></a>00113 
<a name="l00122"></a><a class="code" href="class_qext_read_buffer.html#a34e6873c47652c4d334ed9101d7257e5">00122</a>     <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="class_qext_read_buffer.html#a34e6873c47652c4d334ed9101d7257e5">read</a>(<span class="keywordtype">char</span> *target, <span class="keywordtype">int</span> <a class="code" href="class_qext_read_buffer.html#a6a2dcf1b616a57f6f6355db72e7e8052">size</a>) {
<a name="l00123"></a>00123         <span class="keywordtype">int</span> r = qMin(size, <a class="code" href="class_qext_read_buffer.html#aa30b3290fc4d7c660140ce8235bd118e">len</a>);
<a name="l00124"></a>00124         <span class="keywordflow">if</span> (r == 1) {
<a name="l00125"></a>00125             *target = *<a class="code" href="class_qext_read_buffer.html#a74b0541d6654ec67f622e9b4d2af4fed">first</a>;
<a name="l00126"></a>00126             --<a class="code" href="class_qext_read_buffer.html#aa30b3290fc4d7c660140ce8235bd118e">len</a>;
<a name="l00127"></a>00127             ++<a class="code" href="class_qext_read_buffer.html#a74b0541d6654ec67f622e9b4d2af4fed">first</a>;
<a name="l00128"></a>00128         } <span class="keywordflow">else</span> {
<a name="l00129"></a>00129             memcpy(target, <a class="code" href="class_qext_read_buffer.html#a74b0541d6654ec67f622e9b4d2af4fed">first</a>, r);
<a name="l00130"></a>00130             <a class="code" href="class_qext_read_buffer.html#aa30b3290fc4d7c660140ce8235bd118e">len</a> -= r;
<a name="l00131"></a>00131             <a class="code" href="class_qext_read_buffer.html#a74b0541d6654ec67f622e9b4d2af4fed">first</a> += r;
<a name="l00132"></a>00132         }
<a name="l00133"></a>00133         <span class="keywordflow">return</span> r;
<a name="l00134"></a>00134     }
<a name="l00135"></a>00135 
<a name="l00143"></a><a class="code" href="class_qext_read_buffer.html#a84bd4e5fe921b1d9b70fe58d0fc040ba">00143</a>     <span class="keyword">inline</span> <span class="keywordtype">char</span> *<a class="code" href="class_qext_read_buffer.html#a84bd4e5fe921b1d9b70fe58d0fc040ba">reserve</a>(<span class="keywordtype">size_t</span> <a class="code" href="class_qext_read_buffer.html#a6a2dcf1b616a57f6f6355db72e7e8052">size</a>) {
<a name="l00144"></a>00144         <span class="keywordflow">if</span> ((<a class="code" href="class_qext_read_buffer.html#a74b0541d6654ec67f622e9b4d2af4fed">first</a> - <a class="code" href="class_qext_read_buffer.html#ae7e22b951d9a0c2701e801040d282709">buf</a>) + <a class="code" href="class_qext_read_buffer.html#aa30b3290fc4d7c660140ce8235bd118e">len</a> + size &gt; <a class="code" href="class_qext_read_buffer.html#aad8b22b5bacd39e99318937bc2997b8e">capacity</a>) {
<a name="l00145"></a>00145             <span class="keywordtype">size_t</span> newCapacity = qMax(<a class="code" href="class_qext_read_buffer.html#aad8b22b5bacd39e99318937bc2997b8e">capacity</a>, <a class="code" href="class_qext_read_buffer.html#a1a1622e991fd932f499d615a214956ef">basicBlockSize</a>);
<a name="l00146"></a>00146             <span class="keywordflow">while</span> (newCapacity &lt; <a class="code" href="class_qext_read_buffer.html#aa30b3290fc4d7c660140ce8235bd118e">len</a> + size)
<a name="l00147"></a>00147                 newCapacity *= 2;
<a name="l00148"></a>00148             <span class="keywordflow">if</span> (newCapacity &gt; <a class="code" href="class_qext_read_buffer.html#aad8b22b5bacd39e99318937bc2997b8e">capacity</a>) {
<a name="l00149"></a>00149                 <span class="comment">// allocate more space</span>
<a name="l00150"></a>00150                 <span class="keywordtype">char</span> *newBuf = <span class="keyword">new</span> <span class="keywordtype">char</span>[newCapacity];
<a name="l00151"></a>00151                 memmove(newBuf, <a class="code" href="class_qext_read_buffer.html#a74b0541d6654ec67f622e9b4d2af4fed">first</a>, <a class="code" href="class_qext_read_buffer.html#aa30b3290fc4d7c660140ce8235bd118e">len</a>);
<a name="l00152"></a>00152                 <span class="keyword">delete</span> [] <a class="code" href="class_qext_read_buffer.html#ae7e22b951d9a0c2701e801040d282709">buf</a>;
<a name="l00153"></a>00153                 <a class="code" href="class_qext_read_buffer.html#ae7e22b951d9a0c2701e801040d282709">buf</a> = newBuf;
<a name="l00154"></a>00154                 <a class="code" href="class_qext_read_buffer.html#aad8b22b5bacd39e99318937bc2997b8e">capacity</a> = newCapacity;
<a name="l00155"></a>00155             } <span class="keywordflow">else</span> {
<a name="l00156"></a>00156                 <span class="comment">// shift any existing data to make space</span>
<a name="l00157"></a>00157                 memmove(<a class="code" href="class_qext_read_buffer.html#ae7e22b951d9a0c2701e801040d282709">buf</a>, <a class="code" href="class_qext_read_buffer.html#a74b0541d6654ec67f622e9b4d2af4fed">first</a>, <a class="code" href="class_qext_read_buffer.html#aa30b3290fc4d7c660140ce8235bd118e">len</a>);
<a name="l00158"></a>00158             }
<a name="l00159"></a>00159             <a class="code" href="class_qext_read_buffer.html#a74b0541d6654ec67f622e9b4d2af4fed">first</a> = <a class="code" href="class_qext_read_buffer.html#ae7e22b951d9a0c2701e801040d282709">buf</a>;
<a name="l00160"></a>00160         }
<a name="l00161"></a>00161         <span class="keywordtype">char</span> *writePtr = <a class="code" href="class_qext_read_buffer.html#a74b0541d6654ec67f622e9b4d2af4fed">first</a> + <a class="code" href="class_qext_read_buffer.html#aa30b3290fc4d7c660140ce8235bd118e">len</a>;
<a name="l00162"></a>00162         len += (int)size;
<a name="l00163"></a>00163         <span class="keywordflow">return</span> writePtr;
<a name="l00164"></a>00164     }
<a name="l00165"></a>00165 
<a name="l00172"></a><a class="code" href="class_qext_read_buffer.html#a8453c85b61affc9155de494e89b356b4">00172</a>     <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="class_qext_read_buffer.html#a8453c85b61affc9155de494e89b356b4">chop</a>(<span class="keywordtype">int</span> <a class="code" href="class_qext_read_buffer.html#a6a2dcf1b616a57f6f6355db72e7e8052">size</a>) {
<a name="l00173"></a>00173         <span class="keywordflow">if</span> (size &gt;= <a class="code" href="class_qext_read_buffer.html#aa30b3290fc4d7c660140ce8235bd118e">len</a>) {
<a name="l00174"></a>00174             <a class="code" href="class_qext_read_buffer.html#a2391683c7c1b5b62d771dda087b868e2">clear</a>();
<a name="l00175"></a>00175         } <span class="keywordflow">else</span> {
<a name="l00176"></a>00176             <a class="code" href="class_qext_read_buffer.html#aa30b3290fc4d7c660140ce8235bd118e">len</a> -= <a class="code" href="class_qext_read_buffer.html#a6a2dcf1b616a57f6f6355db72e7e8052">size</a>;
<a name="l00177"></a>00177         }
<a name="l00178"></a>00178     }
<a name="l00179"></a>00179 
<a name="l00185"></a><a class="code" href="class_qext_read_buffer.html#aceefdb6ad1fa829cd584d82b352355c2">00185</a>     <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="class_qext_read_buffer.html#aceefdb6ad1fa829cd584d82b352355c2">squeeze</a>() {
<a name="l00186"></a>00186         <span class="keywordflow">if</span> (<a class="code" href="class_qext_read_buffer.html#a74b0541d6654ec67f622e9b4d2af4fed">first</a> != <a class="code" href="class_qext_read_buffer.html#ae7e22b951d9a0c2701e801040d282709">buf</a>) {
<a name="l00187"></a>00187             memmove(<a class="code" href="class_qext_read_buffer.html#ae7e22b951d9a0c2701e801040d282709">buf</a>, <a class="code" href="class_qext_read_buffer.html#a74b0541d6654ec67f622e9b4d2af4fed">first</a>, <a class="code" href="class_qext_read_buffer.html#aa30b3290fc4d7c660140ce8235bd118e">len</a>);
<a name="l00188"></a>00188             <a class="code" href="class_qext_read_buffer.html#a74b0541d6654ec67f622e9b4d2af4fed">first</a> = <a class="code" href="class_qext_read_buffer.html#ae7e22b951d9a0c2701e801040d282709">buf</a>;
<a name="l00189"></a>00189         }
<a name="l00190"></a>00190         <span class="keywordtype">size_t</span> newCapacity = <a class="code" href="class_qext_read_buffer.html#a1a1622e991fd932f499d615a214956ef">basicBlockSize</a>;
<a name="l00191"></a>00191         <span class="keywordflow">while</span> (newCapacity &lt; <span class="keywordtype">size_t</span>(<a class="code" href="class_qext_read_buffer.html#aa30b3290fc4d7c660140ce8235bd118e">len</a>))
<a name="l00192"></a>00192             newCapacity *= 2;
<a name="l00193"></a>00193         <span class="keywordflow">if</span> (newCapacity &lt; <a class="code" href="class_qext_read_buffer.html#aad8b22b5bacd39e99318937bc2997b8e">capacity</a>) {
<a name="l00194"></a>00194             <span class="keywordtype">char</span> *tmp = <span class="keyword">static_cast&lt;</span><span class="keywordtype">char</span> *<span class="keyword">&gt;</span>(realloc(<a class="code" href="class_qext_read_buffer.html#ae7e22b951d9a0c2701e801040d282709">buf</a>, newCapacity));
<a name="l00195"></a>00195             <span class="keywordflow">if</span> (tmp) {
<a name="l00196"></a>00196                 <a class="code" href="class_qext_read_buffer.html#ae7e22b951d9a0c2701e801040d282709">buf</a> = tmp;
<a name="l00197"></a>00197                 <a class="code" href="class_qext_read_buffer.html#aad8b22b5bacd39e99318937bc2997b8e">capacity</a> = newCapacity;
<a name="l00198"></a>00198             }
<a name="l00199"></a>00199         }
<a name="l00200"></a>00200     }
<a name="l00201"></a>00201 
<a name="l00208"></a><a class="code" href="class_qext_read_buffer.html#a057c8405e774d95a0580add142835b08">00208</a>     <span class="keyword">inline</span> QByteArray <a class="code" href="class_qext_read_buffer.html#a057c8405e774d95a0580add142835b08">readAll</a>() {
<a name="l00209"></a>00209         <span class="keywordtype">char</span> *f = <a class="code" href="class_qext_read_buffer.html#a74b0541d6654ec67f622e9b4d2af4fed">first</a>;
<a name="l00210"></a>00210         <span class="keywordtype">int</span> l = <a class="code" href="class_qext_read_buffer.html#aa30b3290fc4d7c660140ce8235bd118e">len</a>;
<a name="l00211"></a>00211         <a class="code" href="class_qext_read_buffer.html#a2391683c7c1b5b62d771dda087b868e2">clear</a>();
<a name="l00212"></a>00212         <span class="keywordflow">return</span> QByteArray(f, l);
<a name="l00213"></a>00213     }
<a name="l00214"></a>00214 
<a name="l00223"></a><a class="code" href="class_qext_read_buffer.html#a6a375de98e6c62300672a2b3257e4191">00223</a>     <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="class_qext_read_buffer.html#a6a375de98e6c62300672a2b3257e4191">readLine</a>(<span class="keywordtype">char</span> *target, <span class="keywordtype">int</span> <a class="code" href="class_qext_read_buffer.html#a6a2dcf1b616a57f6f6355db72e7e8052">size</a>) {
<a name="l00224"></a>00224         <span class="keywordtype">int</span> r = qMin(size, <a class="code" href="class_qext_read_buffer.html#aa30b3290fc4d7c660140ce8235bd118e">len</a>);
<a name="l00225"></a>00225         <span class="keywordtype">char</span> *eol = <span class="keyword">static_cast&lt;</span><span class="keywordtype">char</span> *<span class="keyword">&gt;</span>(memchr(<a class="code" href="class_qext_read_buffer.html#a74b0541d6654ec67f622e9b4d2af4fed">first</a>, <span class="charliteral">&#39;\n&#39;</span>, r));
<a name="l00226"></a>00226         <span class="keywordflow">if</span> (eol)
<a name="l00227"></a>00227             r = 1+(eol-<a class="code" href="class_qext_read_buffer.html#a74b0541d6654ec67f622e9b4d2af4fed">first</a>);
<a name="l00228"></a>00228         memcpy(target, <a class="code" href="class_qext_read_buffer.html#a74b0541d6654ec67f622e9b4d2af4fed">first</a>, r);
<a name="l00229"></a>00229         <a class="code" href="class_qext_read_buffer.html#aa30b3290fc4d7c660140ce8235bd118e">len</a> -= r;
<a name="l00230"></a>00230         <a class="code" href="class_qext_read_buffer.html#a74b0541d6654ec67f622e9b4d2af4fed">first</a> += r;
<a name="l00231"></a>00231         <span class="keywordflow">return</span> int(r);
<a name="l00232"></a>00232     }
<a name="l00233"></a>00233 
<a name="l00240"></a><a class="code" href="class_qext_read_buffer.html#aff6e8e9009bb56c8655e537aa8c99276">00240</a>     <span class="keyword">inline</span> <span class="keywordtype">bool</span> <a class="code" href="class_qext_read_buffer.html#aff6e8e9009bb56c8655e537aa8c99276">canReadLine</a>()<span class="keyword"> const </span>{
<a name="l00241"></a>00241         <span class="keywordflow">return</span> memchr(<a class="code" href="class_qext_read_buffer.html#a74b0541d6654ec67f622e9b4d2af4fed">first</a>, <span class="charliteral">&#39;\n&#39;</span>, <a class="code" href="class_qext_read_buffer.html#aa30b3290fc4d7c660140ce8235bd118e">len</a>);
<a name="l00242"></a>00242     }
<a name="l00243"></a>00243 
<a name="l00244"></a>00244 <span class="keyword">private</span>:
<a name="l00245"></a><a class="code" href="class_qext_read_buffer.html#aa30b3290fc4d7c660140ce8235bd118e">00245</a>     <span class="keywordtype">int</span> <a class="code" href="class_qext_read_buffer.html#aa30b3290fc4d7c660140ce8235bd118e">len</a>; 
<a name="l00246"></a><a class="code" href="class_qext_read_buffer.html#a74b0541d6654ec67f622e9b4d2af4fed">00246</a>     <span class="keywordtype">char</span> *<a class="code" href="class_qext_read_buffer.html#a74b0541d6654ec67f622e9b4d2af4fed">first</a>; 
<a name="l00247"></a><a class="code" href="class_qext_read_buffer.html#ae7e22b951d9a0c2701e801040d282709">00247</a>     <span class="keywordtype">char</span> *<a class="code" href="class_qext_read_buffer.html#ae7e22b951d9a0c2701e801040d282709">buf</a>; 
<a name="l00248"></a><a class="code" href="class_qext_read_buffer.html#aad8b22b5bacd39e99318937bc2997b8e">00248</a>     <span class="keywordtype">size_t</span> <a class="code" href="class_qext_read_buffer.html#aad8b22b5bacd39e99318937bc2997b8e">capacity</a>; 
<a name="l00249"></a><a class="code" href="class_qext_read_buffer.html#a1a1622e991fd932f499d615a214956ef">00249</a>     <span class="keywordtype">size_t</span> <a class="code" href="class_qext_read_buffer.html#a1a1622e991fd932f499d615a214956ef">basicBlockSize</a>; 
<a name="l00250"></a>00250 };
<a name="l00251"></a>00251 
<a name="l00252"></a>00252 <span class="keyword">class </span>QWinEventNotifier;
<a name="l00253"></a>00253 <span class="keyword">class </span>QReadWriteLock;
<a name="l00254"></a>00254 <span class="keyword">class </span>QSocketNotifier;
<a name="l00255"></a>00255 
<a name="l00261"></a><a class="code" href="class_qext_serial_port_private.html">00261</a> <span class="keyword">class </span><a class="code" href="class_qext_serial_port_private.html">QextSerialPortPrivate</a>
<a name="l00262"></a>00262 {
<a name="l00263"></a>00263     Q_DECLARE_PUBLIC(<a class="code" href="class_qext_serial_port.html" title="The QextSerialPort class encapsulates a serial port on both POSIX and Windows systems.">QextSerialPort</a>)
<a name="l00264"></a>00264 <span class="keyword">public</span>:
<a name="l00271"></a>00271     <a class="code" href="class_qext_serial_port_private.html#ae40028def454b3b7ceda96590c843561">QextSerialPortPrivate</a>(<a class="code" href="class_qext_serial_port.html" title="The QextSerialPort class encapsulates a serial port on both POSIX and Windows systems.">QextSerialPort</a> *q);
<a name="l00277"></a>00277     <a class="code" href="class_qext_serial_port_private.html#aaf8e2c5a3308444c12309837cc732fe4">~QextSerialPortPrivate</a>();
<a name="l00283"></a><a class="code" href="class_qext_serial_port_private.html#aa01dd651b5e00ba94515383b08a8bbd5">00283</a>     <span class="keyword">enum</span> <a class="code" href="class_qext_serial_port_private.html#aa01dd651b5e00ba94515383b08a8bbd5">DirtyFlagEnum</a>
<a name="l00284"></a>00284     {
<a name="l00285"></a><a class="code" href="class_qext_serial_port_private.html#aa01dd651b5e00ba94515383b08a8bbd5a87966a62db50b5bd3039480ad69c6d09">00285</a>         <a class="code" href="class_qext_serial_port_private.html#aa01dd651b5e00ba94515383b08a8bbd5a87966a62db50b5bd3039480ad69c6d09">DFE_BaudRate</a> = 0x0001,
<a name="l00286"></a><a class="code" href="class_qext_serial_port_private.html#aa01dd651b5e00ba94515383b08a8bbd5a1cec7a2856ad75c5c811f585e6374de1">00286</a>         <a class="code" href="class_qext_serial_port_private.html#aa01dd651b5e00ba94515383b08a8bbd5a1cec7a2856ad75c5c811f585e6374de1">DFE_Parity</a> = 0x0002,
<a name="l00287"></a><a class="code" href="class_qext_serial_port_private.html#aa01dd651b5e00ba94515383b08a8bbd5a395e3b2675bdb69478088786d4096e94">00287</a>         <a class="code" href="class_qext_serial_port_private.html#aa01dd651b5e00ba94515383b08a8bbd5a395e3b2675bdb69478088786d4096e94">DFE_StopBits</a> = 0x0004,
<a name="l00288"></a><a class="code" href="class_qext_serial_port_private.html#aa01dd651b5e00ba94515383b08a8bbd5abf29442de97de6f5374589007d24e6d4">00288</a>         <a class="code" href="class_qext_serial_port_private.html#aa01dd651b5e00ba94515383b08a8bbd5abf29442de97de6f5374589007d24e6d4">DFE_DataBits</a> = 0x0008,
<a name="l00289"></a><a class="code" href="class_qext_serial_port_private.html#aa01dd651b5e00ba94515383b08a8bbd5a4486b803dd73352c391216c39494eb20">00289</a>         <a class="code" href="class_qext_serial_port_private.html#aa01dd651b5e00ba94515383b08a8bbd5a4486b803dd73352c391216c39494eb20">DFE_Flow</a> = 0x0010,
<a name="l00290"></a><a class="code" href="class_qext_serial_port_private.html#aa01dd651b5e00ba94515383b08a8bbd5a763127cc0e1a1b512a4430c99bd9a0df">00290</a>         <a class="code" href="class_qext_serial_port_private.html#aa01dd651b5e00ba94515383b08a8bbd5a763127cc0e1a1b512a4430c99bd9a0df">DFE_TimeOut</a> = 0x0100,
<a name="l00291"></a><a class="code" href="class_qext_serial_port_private.html#aa01dd651b5e00ba94515383b08a8bbd5a6382379792be30bd39a32986e9a0b0a7">00291</a>         <a class="code" href="class_qext_serial_port_private.html#aa01dd651b5e00ba94515383b08a8bbd5a6382379792be30bd39a32986e9a0b0a7">DFE_ALL</a> = 0x0fff,
<a name="l00292"></a><a class="code" href="class_qext_serial_port_private.html#aa01dd651b5e00ba94515383b08a8bbd5a5d21fcfe673df66d5bc39b410127dd53">00292</a>         <a class="code" href="class_qext_serial_port_private.html#aa01dd651b5e00ba94515383b08a8bbd5a5d21fcfe673df66d5bc39b410127dd53">DFE_Settings_Mask</a> = 0x00ff <span class="comment">//without TimeOut</span>
<a name="l00293"></a>00293     };
<a name="l00294"></a><a class="code" href="class_qext_serial_port_private.html#a5b461024ffc2ced2aab35f9ea2479678">00294</a>     <span class="keyword">mutable</span> QReadWriteLock <a class="code" href="class_qext_serial_port_private.html#a5b461024ffc2ced2aab35f9ea2479678">lock</a>; 
<a name="l00295"></a><a class="code" href="class_qext_serial_port_private.html#ad71bd4158f2a126e9bc4d81945e44f49">00295</a>     QString <a class="code" href="class_qext_serial_port_private.html#ad71bd4158f2a126e9bc4d81945e44f49">port</a>; 
<a name="l00296"></a><a class="code" href="class_qext_serial_port_private.html#a3e5003cc8b0fe0d8ac2384473073b112">00296</a>     <a class="code" href="struct_port_settings.html" title="The PortSettings class contain port settings.">PortSettings</a> <a class="code" href="class_qext_serial_port_private.html#a3e5003cc8b0fe0d8ac2384473073b112">settings</a>; 
<a name="l00297"></a><a class="code" href="class_qext_serial_port_private.html#a70b82e3f7cd919b5f6cece84d97f8c69">00297</a>     <a class="code" href="class_qext_read_buffer.html">QextReadBuffer</a> <a class="code" href="class_qext_serial_port_private.html#a70b82e3f7cd919b5f6cece84d97f8c69">readBuffer</a>; 
<a name="l00298"></a><a class="code" href="class_qext_serial_port_private.html#a34e162f9f23ec8628ba91b96c3195c08">00298</a>     <span class="keywordtype">int</span> <a class="code" href="class_qext_serial_port_private.html#a34e162f9f23ec8628ba91b96c3195c08">settingsDirtyFlags</a>; 
<a name="l00299"></a><a class="code" href="class_qext_serial_port_private.html#a20d35bc9b81de6f67bc935cb1095dab9">00299</a>     ulong <a class="code" href="class_qext_serial_port_private.html#a20d35bc9b81de6f67bc935cb1095dab9">lastErr</a>; 
<a name="l00300"></a><a class="code" href="class_qext_serial_port_private.html#a96c0bd1305fc54c331692b4cb9af1724">00300</a>     <a class="code" href="class_qext_serial_port.html#a6002128d7351ea9a958d6a6d1fc6b9bd">QextSerialPort::QueryMode</a> <a class="code" href="class_qext_serial_port_private.html#a96c0bd1305fc54c331692b4cb9af1724">queryMode</a>; 
<a name="l00302"></a>00302     <span class="comment">// platform specific members</span>
<a name="l00303"></a>00303 <span class="preprocessor">#ifdef Q_OS_UNIX</span>
<a name="l00304"></a>00304 <span class="preprocessor"></span>    <span class="keywordtype">int</span> fd; 
<a name="l00305"></a>00305     QSocketNotifier *readNotifier; 
<a name="l00306"></a>00306     <span class="keyword">struct </span>termios currentTermios; 
<a name="l00307"></a>00307     <span class="keyword">struct </span>termios oldTermios; 
<a name="l00308"></a>00308 <span class="preprocessor">#elif (defined Q_OS_WIN)</span>
<a name="l00309"></a>00309 <span class="preprocessor"></span>    HANDLE handle;
<a name="l00310"></a>00310     OVERLAPPED overlap;
<a name="l00311"></a>00311     COMMCONFIG commConfig;
<a name="l00312"></a>00312     COMMTIMEOUTS commTimeouts;
<a name="l00313"></a>00313     QWinEventNotifier *winEventNotifier;
<a name="l00314"></a>00314     DWORD eventMask;
<a name="l00315"></a>00315     QList&lt;OVERLAPPED *&gt; pendingWrites;
<a name="l00316"></a>00316     QReadWriteLock *bytesToWriteLock;
<a name="l00317"></a>00317 <span class="preprocessor">#endif</span>
<a name="l00318"></a>00318 <span class="preprocessor"></span>
<a name="l00319"></a>00319     <span class="comment">/*fill PortSettings*/</span>
<a name="l00327"></a>00327     <span class="keywordtype">void</span> <a class="code" href="class_qext_serial_port_private.html#aebd92555141f8a4c2c350d38c2fbd7c8">setBaudRate</a>(<a class="code" href="qextserialport_8h.html#a6f031169a6a9b150b5af707bb23cf010">BaudRateType</a> baudRate, <span class="keywordtype">bool</span> update=<span class="keyword">true</span>);
<a name="l00335"></a>00335     <span class="keywordtype">void</span> <a class="code" href="class_qext_serial_port_private.html#ac6f82b49b1175ebfdfeb88b668f2827c">setDataBits</a>(<a class="code" href="qextserialport_8h.html#a189ef78c2c1b7537ab114d576f6214fa">DataBitsType</a> dataBits, <span class="keywordtype">bool</span> update=<span class="keyword">true</span>);
<a name="l00343"></a>00343     <span class="keywordtype">void</span> <a class="code" href="class_qext_serial_port_private.html#a55a486b9e7151058b2298294eb132e00">setParity</a>(<a class="code" href="qextserialport_8h.html#aee22d32d87c815090354bf9b8e957ace">ParityType</a> parity, <span class="keywordtype">bool</span> update=<span class="keyword">true</span>);
<a name="l00351"></a>00351     <span class="keywordtype">void</span> <a class="code" href="class_qext_serial_port_private.html#afc7498b07f28c11c6beae112545d054c">setStopBits</a>(<a class="code" href="qextserialport_8h.html#adc8078895cd941d755d46633b54d3e7f">StopBitsType</a> stopbits, <span class="keywordtype">bool</span> update=<span class="keyword">true</span>);
<a name="l00359"></a>00359     <span class="keywordtype">void</span> <a class="code" href="class_qext_serial_port_private.html#ae2134c8d0b1af0678956891b5a1e9029">setFlowControl</a>(<a class="code" href="qextserialport_8h.html#a02ad1c7cf791a069dd54e409f8db4790">FlowType</a> flow, <span class="keywordtype">bool</span> update=<span class="keyword">true</span>);
<a name="l00367"></a>00367     <span class="keywordtype">void</span> <a class="code" href="class_qext_serial_port_private.html#af24d8d302b850ada9d98b45186fe7771">setTimeout</a>(<span class="keywordtype">long</span> millisec, <span class="keywordtype">bool</span> update=<span class="keyword">true</span>);
<a name="l00375"></a>00375     <span class="keywordtype">void</span> <a class="code" href="class_qext_serial_port_private.html#acc0ca2380765e9cfbb5555ddd4864760">setPortSettings</a>(<span class="keyword">const</span> <a class="code" href="struct_port_settings.html" title="The PortSettings class contain port settings.">PortSettings</a> &amp;<a class="code" href="class_qext_serial_port_private.html#a3e5003cc8b0fe0d8ac2384473073b112">settings</a>, <span class="keywordtype">bool</span> update=<span class="keyword">true</span>);
<a name="l00376"></a>00376 
<a name="l00382"></a>00382     <span class="keywordtype">void</span> <a class="code" href="class_qext_serial_port_private.html#a43f36344c4f79f1851860118975495f6">platformSpecificDestruct</a>();
<a name="l00388"></a>00388     <span class="keywordtype">void</span> <a class="code" href="class_qext_serial_port_private.html#a073ce50d9be23dfc9dee51bde7f41e0b">platformSpecificInit</a>();
<a name="l00395"></a>00395     <span class="keywordtype">void</span> <a class="code" href="class_qext_serial_port_private.html#af504151e61016c5e8a6d93378b834602">translateError</a>(ulong error);
<a name="l00401"></a>00401     <span class="keywordtype">void</span> <a class="code" href="class_qext_serial_port_private.html#a93dbaf89172345288b00e936bc3ea87c">updatePortSettings</a>();
<a name="l00402"></a>00402 
<a name="l00411"></a>00411     qint64 <a class="code" href="class_qext_serial_port_private.html#ab4a75579c479ccebb5f325af737a7045">readData_sys</a>(<span class="keywordtype">char</span> *data, qint64 maxSize);
<a name="l00420"></a>00420     qint64 <a class="code" href="class_qext_serial_port_private.html#a54ad0646018e3a519582c81fd3631cc2">writeData_sys</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *data, qint64 maxSize);
<a name="l00427"></a>00427     <span class="keywordtype">void</span> <a class="code" href="class_qext_serial_port_private.html#af275a7dcc4a593d01b78e7997c4fb075">setDtr_sys</a>(<span class="keywordtype">bool</span> <span class="keyword">set</span>=<span class="keyword">true</span>);
<a name="l00434"></a>00434     <span class="keywordtype">void</span> <a class="code" href="class_qext_serial_port_private.html#aafb561e6173cd73470a8369af029dd36">setRts_sys</a>(<span class="keywordtype">bool</span> <span class="keyword">set</span>=<span class="keyword">true</span>);
<a name="l00442"></a>00442     <span class="keywordtype">bool</span> <a class="code" href="class_qext_serial_port_private.html#aa0f8791cf7196d6544c6ab5fa7227c9e">open_sys</a>(QIODevice::OpenMode mode);
<a name="l00449"></a>00449     <span class="keywordtype">bool</span> <a class="code" href="class_qext_serial_port_private.html#a7838ce80fb6a77d1e978b9839d97e9c0">close_sys</a>();
<a name="l00456"></a>00456     <span class="keywordtype">bool</span> <a class="code" href="class_qext_serial_port_private.html#a237f7f6b7d1dbf43d83f4f747e2f577b">flush_sys</a>();
<a name="l00463"></a>00463     ulong <a class="code" href="class_qext_serial_port_private.html#a62a36776b0d0ac6047f7f2ab911511e6">lineStatus_sys</a>();
<a name="l00470"></a>00470     qint64 <a class="code" href="class_qext_serial_port_private.html#a08f7713afcdbadd43a845233a659986d">bytesAvailable_sys</a>() <span class="keyword">const</span>;
<a name="l00471"></a>00471 
<a name="l00472"></a>00472 <span class="preprocessor">#ifdef Q_OS_WIN</span>
<a name="l00473"></a>00473 <span class="preprocessor"></span>    <span class="keywordtype">void</span> _q_onWinEvent(HANDLE h);
<a name="l00474"></a>00474 <span class="preprocessor">#endif</span>
<a name="l00475"></a>00475 <span class="preprocessor"></span>
<a name="l00480"></a>00480     <span class="keywordtype">void</span> <a class="code" href="class_qext_serial_port_private.html#a808adcf47e790e1530e966a0b736db7c">_q_canRead</a>();
<a name="l00481"></a>00481 
<a name="l00482"></a><a class="code" href="class_qext_serial_port_private.html#ac1a6c45f7c3621d5f926d5250cdac194">00482</a>     <a class="code" href="class_qext_serial_port.html" title="The QextSerialPort class encapsulates a serial port on both POSIX and Windows systems.">QextSerialPort</a> *<a class="code" href="class_qext_serial_port_private.html#ac1a6c45f7c3621d5f926d5250cdac194">q_ptr</a>; 
<a name="l00483"></a>00483 };
<a name="l00484"></a>00484 
<a name="l00485"></a>00485 <span class="preprocessor">#endif //_QEXTSERIALPORT_P_H_</span>
</pre></div></div><!-- contents -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>Tout</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Fichiers</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Fonctions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Énumérations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Valeurs énumérées</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Propriétés</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Macros</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>



<hr class="footer"/><address class="footer"><small>
Généré le Samedi Mars 24 2018 11:49:24 pour WISMAS par &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.6.1
</small></address>

</body>
</html>
